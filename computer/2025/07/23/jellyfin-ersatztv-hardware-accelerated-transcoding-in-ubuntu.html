<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Jellyfin &amp; ErsatzTV在J4125小主机的Ubuntu系统上实现硬件加速转码 | 开放笔记</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Jellyfin &amp; ErsatzTV在J4125小主机的Ubuntu系统上实现硬件加速转码" />
<meta name="author" content="徐顺发" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="记录生活、学习和思考" />
<meta property="og:description" content="记录生活、学习和思考" />
<link rel="canonical" href="https://goooooouwa.github.io/computer/2025/07/23/jellyfin-ersatztv-hardware-accelerated-transcoding-in-ubuntu.html" />
<meta property="og:url" content="https://goooooouwa.github.io/computer/2025/07/23/jellyfin-ersatztv-hardware-accelerated-transcoding-in-ubuntu.html" />
<meta property="og:site_name" content="开放笔记" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-07-23T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Jellyfin &amp; ErsatzTV在J4125小主机的Ubuntu系统上实现硬件加速转码" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"徐顺发"},"dateModified":"2025-07-23T00:00:00+00:00","datePublished":"2025-07-23T00:00:00+00:00","description":"记录生活、学习和思考","headline":"Jellyfin &amp; ErsatzTV在J4125小主机的Ubuntu系统上实现硬件加速转码","mainEntityOfPage":{"@type":"WebPage","@id":"https://goooooouwa.github.io/computer/2025/07/23/jellyfin-ersatztv-hardware-accelerated-transcoding-in-ubuntu.html"},"url":"https://goooooouwa.github.io/computer/2025/07/23/jellyfin-ersatztv-hardware-accelerated-transcoding-in-ubuntu.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://goooooouwa.github.io/feed.xml" title="开放笔记" /><script async src="https://www.googletagmanager.com/gtag/js?id=G-669F0VG7BL"></script>
<script>
  window['ga-disable-G-669F0VG7BL'] = window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1";
  window.dataLayer = window.dataLayer || [];
  function gtag(){window.dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-669F0VG7BL');
</script>
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
<link rel="stylesheet" href="/assets/css/google-custom-search-style-fix.css">
<script data-ad-client="ca-pub-6847741633817418" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script src=/assets/javascript/chartjs-2.9.3/chart.min.js></script>
<script src=/assets/javascript/mermaid-8.7.0/mermaid.min.js></script></head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">开放笔记</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/categories.html">分类</a><a class="page-link" href="/tags.html">标签</a><a class="page-link" href="/wiki.html">Wiki</a><a class="page-link" href="/about/">关于作者</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Jellyfin &amp; ErsatzTV在J4125小主机的Ubuntu系统上实现硬件加速转码</h1>
    <p class="post-meta"><time class="dt-published" datetime="2025-07-23T00:00:00+00:00" itemprop="datePublished">
        Jul 23, 2025
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="markdown-toc">
  <li><a href="#在j4125小主机的ubuntu系统上运行jellyfin并实现硬件加速转码的步骤" id="markdown-toc-在j4125小主机的ubuntu系统上运行jellyfin并实现硬件加速转码的步骤">在J4125小主机的Ubuntu系统上运行Jellyfin并实现硬件加速转码的步骤：</a>    <ul>
      <li><a href="#1-按照jellyfin官方文档在ubuntu上安装jellyfin" id="markdown-toc-1-按照jellyfin官方文档在ubuntu上安装jellyfin">1 按照Jellyfin官方文档在Ubuntu上安装Jellyfin</a></li>
      <li><a href="#2-按照jellyfin官方文档在ubuntu上完成qsv--va-api-codecs硬件解码器相关设置并验证硬件是否正常工作" id="markdown-toc-2-按照jellyfin官方文档在ubuntu上完成qsv--va-api-codecs硬件解码器相关设置并验证硬件是否正常工作">2 按照Jellyfin官方文档在Ubuntu上完成QSV / VA-API codecs硬件解码器相关设置并验证硬件是否正常工作</a>        <ul>
          <li><a href="#21-add-the-jellyfin-repository-to-your-apt-source-list" id="markdown-toc-21-add-the-jellyfin-repository-to-your-apt-source-list">2.1 Add the jellyfin repository to your apt source list</a></li>
          <li><a href="#22-install-the-jellyfin-ffmpeg7-package" id="markdown-toc-22-install-the-jellyfin-ffmpeg7-package">2.2 Install the jellyfin-ffmpeg7 package</a></li>
          <li><a href="#23-make-sure-at-least-one-renderd-device-exists-in-devdri-otherwise-upgrade-your-kernel-or-enable-the-igpu-in-the-bios" id="markdown-toc-23-make-sure-at-least-one-renderd-device-exists-in-devdri-otherwise-upgrade-your-kernel-or-enable-the-igpu-in-the-bios">2.3 Make sure at least one renderD* device exists in /dev/dri. Otherwise upgrade your kernel or enable the iGPU in the BIOS.</a></li>
          <li><a href="#24-add-the-jellyfin-user-to-the-render-group-then-restart-jellyfin-service" id="markdown-toc-24-add-the-jellyfin-user-to-the-render-group-then-restart-jellyfin-service">2.4 Add the jellyfin user to the render group, then restart jellyfin service:</a></li>
          <li><a href="#25-check-the-version-of-intel-opencl-icd-that-the-linux-distro-provides" id="markdown-toc-25-check-the-version-of-intel-opencl-icd-that-the-linux-distro-provides">2.5 Check the version of intel-opencl-icd that the Linux distro provides:</a></li>
          <li><a href="#26-if-the-version-is-newer-than-22xxxxxxx-just-install-it" id="markdown-toc-26-if-the-version-is-newer-than-22xxxxxxx-just-install-it">2.6 If the version is newer than 22.xx.xxxxx just install it.</a></li>
          <li><a href="#27-check-the-supported-qsv--va-api-codecs" id="markdown-toc-27-check-the-supported-qsv--va-api-codecs">2.7 Check the supported QSV / VA-API codecs:</a></li>
          <li><a href="#28-check-the-opencl-runtime-status" id="markdown-toc-28-check-the-opencl-runtime-status">2.8 Check the OpenCL runtime status</a></li>
        </ul>
      </li>
      <li><a href="#3-在jellyfin中开启硬件加速转码选择qsv选项" id="markdown-toc-3-在jellyfin中开启硬件加速转码选择qsv选项">3 在Jellyfin中开启硬件加速转码，选择QSV选项</a></li>
      <li><a href="#4-验证jellyfin能成功通过qsv完成硬件加速转码" id="markdown-toc-4-验证jellyfin能成功通过qsv完成硬件加速转码">4 验证Jellyfin能成功通过QSV完成硬件加速转码</a>        <ul>
          <li><a href="#41-install-the-intel-gpu-tools-package-on-the-host-system" id="markdown-toc-41-install-the-intel-gpu-tools-package-on-the-host-system">4.1 Install the intel-gpu-tools package on the host system</a></li>
          <li><a href="#42-play-a-video-in-jellyfin-web-client-and-trigger-a-video-transcoding-by-setting-a-lower-resolution-or-bitrate" id="markdown-toc-42-play-a-video-in-jellyfin-web-client-and-trigger-a-video-transcoding-by-setting-a-lower-resolution-or-bitrate">4.2 Play a video in Jellyfin web client and trigger a video transcoding by setting a lower resolution or bitrate.</a></li>
          <li><a href="#43-use-intel_gpu_top-command-to-check-the-occupancy-of-the-engines-as-follows" id="markdown-toc-43-use-intel_gpu_top-command-to-check-the-occupancy-of-the-engines-as-follows">4.3 Use <code class="language-plaintext highlighter-rouge">intel_gpu_top</code> command to check the occupancy of the engines as follows:</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#在j4125小主机上通过docker运行jellyfin并实现硬件加速转码的步骤" id="markdown-toc-在j4125小主机上通过docker运行jellyfin并实现硬件加速转码的步骤">在J4125小主机上通过Docker运行Jellyfin并实现硬件加速转码的步骤：</a>    <ul>
      <li><a href="#1-根据jellyfin官方文档在docker上安装jellyfin" id="markdown-toc-1-根据jellyfin官方文档在docker上安装jellyfin">1 根据Jellyfin官方文档在Docker上安装Jellyfin</a></li>
      <li><a href="#2-query-the-id-of-the-render-group-on-the-host-system" id="markdown-toc-2-query-the-id-of-the-render-group-on-the-host-system">2 Query the id of the render group on the host system</a></li>
      <li><a href="#3-use-render-group-in-the-docker-cli-or-docker-compose-file" id="markdown-toc-3-use-render-group-in-the-docker-cli-or-docker-compose-file">3. Use render group in the Docker CLI or docker-compose file</a></li>
      <li><a href="#4-check-the-qsv-and-va-api-codecs-in-container" id="markdown-toc-4-check-the-qsv-and-va-api-codecs-in-container">4 Check the QSV and VA-API codecs in container</a></li>
      <li><a href="#5-check-the-opencl-runtime-status-in-container" id="markdown-toc-5-check-the-opencl-runtime-status-in-container">5 Check the OpenCL runtime status in container</a></li>
      <li><a href="#6-enable-qsv-or-va-api-in-jellyfin" id="markdown-toc-6-enable-qsv-or-va-api-in-jellyfin">6 Enable QSV or VA-API in Jellyfin</a></li>
    </ul>
  </li>
  <li><a href="#在j4125小主机的ubuntu系统上运行ersatztv并实现硬件加速转码的步骤" id="markdown-toc-在j4125小主机的ubuntu系统上运行ersatztv并实现硬件加速转码的步骤">在J4125小主机的Ubuntu系统上运行ErsatzTV并实现硬件加速转码的步骤：</a>    <ul>
      <li><a href="#1-按照ersatztv官方文档在ubuntu上安装ersatztv" id="markdown-toc-1-按照ersatztv官方文档在ubuntu上安装ersatztv">1 按照ErsatzTV官方文档在Ubuntu上安装ErsatzTV</a></li>
      <li><a href="#2-进入settings将ffpmeg和ffprobe路径改为jellyfin-ffmpeg7的安装路径" id="markdown-toc-2-进入settings将ffpmeg和ffprobe路径改为jellyfin-ffmpeg7的安装路径">2 进入Settings，将ffpmeg和ffprobe路径改为jellyfin-ffmpeg7的安装路径</a></li>
      <li><a href="#3-编辑ffmpeg-profile开启硬件加速转码选择qsv选项" id="markdown-toc-3-编辑ffmpeg-profile开启硬件加速转码选择qsv选项">3 编辑FFmpeg Profile，开启硬件加速转码，选择QSV选项</a></li>
      <li><a href="#4-进入troubleshooting展开qsv-capabilities检查输出结果" id="markdown-toc-4-进入troubleshooting展开qsv-capabilities检查输出结果">4 进入Troubleshooting，展开QSV Capabilities，检查输出结果</a></li>
      <li><a href="#5-auto-start-ersatztv-as-a-systemd-service" id="markdown-toc-5-auto-start-ersatztv-as-a-systemd-service">5 Auto start ersatztv as a systemd service</a></li>
    </ul>
  </li>
</ul>

<h2 id="在j4125小主机的ubuntu系统上运行jellyfin并实现硬件加速转码的步骤">在J4125小主机的Ubuntu系统上运行Jellyfin并实现硬件加速转码的步骤：</h2>

<h3 id="1-按照jellyfin官方文档在ubuntu上安装jellyfin">1 按照<a href="https://jellyfin.org/docs/general/installation/linux/#debian--ubuntu-and-derivatives">Jellyfin官方文档</a>在Ubuntu上安装Jellyfin</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl https://repo.jellyfin.org/install-debuntu.sh | <span class="nb">sudo </span>bash
</code></pre></div></div>

<h3 id="2-按照jellyfin官方文档在ubuntu上完成qsv--va-api-codecs硬件解码器相关设置并验证硬件是否正常工作">2 按照<a href="https://jellyfin.org/docs/general/post-install/transcoding/hardware-acceleration/intel#linux-setups">Jellyfin官方文档</a>在Ubuntu上完成QSV / VA-API codecs硬件解码器相关设置并验证硬件是否正常工作</h3>

<h4 id="21-add-the-jellyfin-repository-to-your-apt-source-list">2.1 Add the jellyfin repository to your apt source list</h4>

<p>官方文档的Jellyfin安装过程中会自动将jellyfin repository添加到apt source list，如果已经完成了Jellyfin的安装，可以直接跳过这一步。</p>

<h4 id="22-install-the-jellyfin-ffmpeg7-package">2.2 Install the jellyfin-ffmpeg7 package</h4>

<p>官方文档的Jellyfin安装过程中会同时安装jellyfin-ffmpeg7，如果已经完成了Jellyfin的安装，可以直接跳过这一步。</p>

<p><code class="language-plaintext highlighter-rouge">sudo apt update &amp;&amp; sudo apt install -y jellyfin-ffmpeg7</code></p>

<h4 id="23-make-sure-at-least-one-renderd-device-exists-in-devdri-otherwise-upgrade-your-kernel-or-enable-the-igpu-in-the-bios">2.3 Make sure at least one renderD* device exists in /dev/dri. Otherwise upgrade your kernel or enable the iGPU in the BIOS.</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> /dev/dri

total 0
drwxr-xr-x  2 root root        120 Mar  5 05:15 by-path
crw-rw----+ 1 root video  226,   0 Mar  5 05:15 card0
crw-rw----+ 1 root video  226,   1 Mar  5 05:15 card1
crw-rw----+ 1 root render 226, 128 Mar  5 05:15 renderD128
crw-rw----+ 1 root render 226, 129 Mar  5 05:15 renderD129
</code></pre></div></div>

<h4 id="24-add-the-jellyfin-user-to-the-render-group-then-restart-jellyfin-service">2.4 Add the jellyfin user to the render group, then restart jellyfin service:</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>usermod <span class="nt">-aG</span> render jellyfin
<span class="nb">sudo </span>systemctl restart jellyfin
</code></pre></div></div>

<h4 id="25-check-the-version-of-intel-opencl-icd-that-the-linux-distro-provides">2.5 Check the version of intel-opencl-icd that the Linux distro provides:</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>apt policy intel-opencl-icd

intel-opencl-icd:
  Installed: <span class="o">(</span>none<span class="o">)</span>
  Candidate: 22.14.22890-1
...
</code></pre></div></div>

<h4 id="26-if-the-version-is-newer-than-22xxxxxxx-just-install-it">2.6 If the version is newer than 22.xx.xxxxx just install it.</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> intel-opencl-icd
</code></pre></div></div>

<h4 id="27-check-the-supported-qsv--va-api-codecs">2.7 Check the supported QSV / VA-API codecs:</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo</span> /usr/lib/jellyfin-ffmpeg/vainfo <span class="nt">--display</span> drm <span class="nt">--device</span> /dev/dri/renderD128

Trying display: drm
libva info: VA-API version 1.22.0
libva info: Trying to open /usr/lib/jellyfin-ffmpeg/lib/dri/iHD_drv_video.so
libva info: Found init <span class="k">function </span>__vaDriverInit_1_22
libva info: va_openDriver<span class="o">()</span> returns 0
vainfo: VA-API version: 1.22 <span class="o">(</span>libva 2.22.0<span class="o">)</span>
vainfo: Driver version: Intel iHD driver <span class="k">for </span>Intel<span class="o">(</span>R<span class="o">)</span> Gen Graphics - 25.2.6 <span class="o">(</span>c6ab0c9<span class="o">)</span>
vainfo: Supported profile and entrypoints
      VAProfileNone                   :	VAEntrypointVideoProc
      VAProfileNone                   :	VAEntrypointStats
      VAProfileMPEG2Simple            :	VAEntrypointVLD
      VAProfileMPEG2Main              :	VAEntrypointVLD
      VAProfileH264Main               :	VAEntrypointVLD
      VAProfileH264Main               :	VAEntrypointEncSlice
      VAProfileH264Main               :	VAEntrypointFEI
      VAProfileH264Main               :	VAEntrypointEncSliceLP
      VAProfileH264High               :	VAEntrypointVLD
      VAProfileH264High               :	VAEntrypointEncSlice
      VAProfileH264High               :	VAEntrypointFEI
      VAProfileH264High               :	VAEntrypointEncSliceLP
      VAProfileVC1Simple              :	VAEntrypointVLD
      VAProfileVC1Main                :	VAEntrypointVLD
      VAProfileVC1Advanced            :	VAEntrypointVLD
      VAProfileJPEGBaseline           :	VAEntrypointVLD
      VAProfileJPEGBaseline           :	VAEntrypointEncPicture
      VAProfileH264ConstrainedBaseline:	VAEntrypointVLD
      VAProfileH264ConstrainedBaseline:	VAEntrypointEncSlice
      VAProfileH264ConstrainedBaseline:	VAEntrypointFEI
      VAProfileH264ConstrainedBaseline:	VAEntrypointEncSliceLP
      VAProfileVP8Version0_3          :	VAEntrypointVLD
      VAProfileVP8Version0_3          :	VAEntrypointEncSlice
      VAProfileHEVCMain               :	VAEntrypointVLD
      VAProfileHEVCMain               :	VAEntrypointEncSlice
      VAProfileHEVCMain               :	VAEntrypointFEI
      VAProfileHEVCMain10             :	VAEntrypointVLD
      VAProfileHEVCMain10             :	VAEntrypointEncSlice
      VAProfileVP9Profile0            :	VAEntrypointVLD
      VAProfileVP9Profile2            :	VAEntrypointVLD
</code></pre></div></div>

<h4 id="28-check-the-opencl-runtime-status">2.8 Check the OpenCL runtime status</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo</span> /usr/lib/jellyfin-ffmpeg/ffmpeg <span class="nt">-v</span> verbose <span class="nt">-init_hw_device</span> <span class="nv">vaapi</span><span class="o">=</span>va:/dev/dri/renderD128 <span class="nt">-init_hw_device</span> opencl@va

ffmpeg version 7.1.1-Jellyfin Copyright <span class="o">(</span>c<span class="o">)</span> 2000-2025 the FFmpeg developers
  built with gcc 11 <span class="o">(</span>Ubuntu 11.4.0-1ubuntu1~22.04<span class="o">)</span>
  configuration: <span class="nt">--prefix</span><span class="o">=</span>/usr/lib/jellyfin-ffmpeg <span class="nt">--target-os</span><span class="o">=</span>linux <span class="nt">--extra-version</span><span class="o">=</span>Jellyfin <span class="nt">--disable-doc</span> <span class="nt">--disable-ffplay</span> <span class="nt">--disable-static</span> <span class="nt">--disable-libxcb</span> <span class="nt">--disable-sdl2</span> <span class="nt">--disable-xlib</span> <span class="nt">--enable-lto</span><span class="o">=</span>auto <span class="nt">--enable-gpl</span> <span class="nt">--enable-version3</span> <span class="nt">--enable-shared</span> <span class="nt">--enable-gmp</span> <span class="nt">--enable-gnutls</span> <span class="nt">--enable-chromaprint</span> <span class="nt">--enable-opencl</span> <span class="nt">--enable-libdrm</span> <span class="nt">--enable-libxml2</span> <span class="nt">--enable-libass</span> <span class="nt">--enable-libfreetype</span> <span class="nt">--enable-libfribidi</span> <span class="nt">--enable-libfontconfig</span> <span class="nt">--enable-libharfbuzz</span> <span class="nt">--enable-libbluray</span> <span class="nt">--enable-libmp3lame</span> <span class="nt">--enable-libopus</span> <span class="nt">--enable-libtheora</span> <span class="nt">--enable-libvorbis</span> <span class="nt">--enable-libopenmpt</span> <span class="nt">--enable-libdav1d</span> <span class="nt">--enable-libsvtav1</span> <span class="nt">--enable-libwebp</span> <span class="nt">--enable-libvpx</span> <span class="nt">--enable-libx264</span> <span class="nt">--enable-libx265</span> <span class="nt">--enable-libzvbi</span> <span class="nt">--enable-libzimg</span> <span class="nt">--enable-libfdk-aac</span> <span class="nt">--arch</span><span class="o">=</span>amd64 <span class="nt">--enable-libshaderc</span> <span class="nt">--enable-libplacebo</span> <span class="nt">--enable-vulkan</span> <span class="nt">--enable-vaapi</span> <span class="nt">--enable-amf</span> <span class="nt">--enable-libvpl</span> <span class="nt">--enable-ffnvcodec</span> <span class="nt">--enable-cuda</span> <span class="nt">--enable-cuda-llvm</span> <span class="nt">--enable-cuvid</span> <span class="nt">--enable-nvdec</span> <span class="nt">--enable-nvenc</span>
  libavutil      59. 39.100 / 59. 39.100
  libavcodec     61. 19.101 / 61. 19.101
  libavformat    61.  7.100 / 61.  7.100
  libavdevice    61.  3.100 / 61.  3.100
  libavfilter    10.  4.100 / 10.  4.100
  libswscale      8.  3.100 /  8.  3.100
  libswresample   5.  3.100 /  5.  3.100
  libpostproc    58.  3.100 / 58.  3.100
<span class="o">[</span>AVHWDeviceContext @ 0x5b98ad31fe80] libva: VA-API version 1.22.0
<span class="o">[</span>AVHWDeviceContext @ 0x5b98ad31fe80] libva: Trying to open /usr/lib/jellyfin-ffmpeg/lib/dri/iHD_drv_video.so
<span class="o">[</span>AVHWDeviceContext @ 0x5b98ad31fe80] libva: Found init <span class="k">function </span>__vaDriverInit_1_22
<span class="o">[</span>AVHWDeviceContext @ 0x5b98ad31fe80] libva: va_openDriver<span class="o">()</span> returns 0
<span class="o">[</span>AVHWDeviceContext @ 0x5b98ad31fe80] Initialised VAAPI connection: version 1.22
<span class="o">[</span>AVHWDeviceContext @ 0x5b98ad31fe80] VAAPI driver: Intel iHD driver <span class="k">for </span>Intel<span class="o">(</span>R<span class="o">)</span> Gen Graphics - 25.2.6 <span class="o">(</span>c6ab0c9<span class="o">)</span><span class="nb">.</span>
<span class="o">[</span>AVHWDeviceContext @ 0x5b98ad31fe80] Driver not found <span class="k">in </span>known nonstandard list, using standard behaviour.
<span class="o">[</span>AVHWDeviceContext @ 0x5b98ad359240] 0.0: Intel<span class="o">(</span>R<span class="o">)</span> OpenCL HD Graphics / Intel<span class="o">(</span>R<span class="o">)</span> UHD Graphics 600 <span class="o">[</span>0x3185]
<span class="o">[</span>AVHWDeviceContext @ 0x5b98ad359240] Intel QSV to OpenCL mapping <span class="k">function </span>found <span class="o">(</span>clCreateFromVA_APIMediaSurfaceINTEL<span class="o">)</span><span class="nb">.</span>
<span class="o">[</span>AVHWDeviceContext @ 0x5b98ad359240] Intel QSV <span class="k">in </span>OpenCL acquire <span class="k">function </span>found <span class="o">(</span>clEnqueueAcquireVA_APIMediaSurfacesINTEL<span class="o">)</span><span class="nb">.</span>
<span class="o">[</span>AVHWDeviceContext @ 0x5b98ad359240] Intel QSV <span class="k">in </span>OpenCL release <span class="k">function </span>found <span class="o">(</span>clEnqueueReleaseVA_APIMediaSurfacesINTEL<span class="o">)</span><span class="nb">.</span>
Universal media converter
usage: ffmpeg <span class="o">[</span>options] <span class="o">[[</span>infile options] <span class="nt">-i</span> infile]... <span class="o">{[</span>outfile options] outfile<span class="o">}</span>...

Use <span class="nt">-h</span> to get full <span class="nb">help </span>or, even better, run <span class="s1">'man ffmpeg'</span>
</code></pre></div></div>

<p><img src="/assets/images/2025-12-22 21-28-00 jellyfin ffmpeg vainfo.png" alt="2025-12-22 21-28-00 jellyfin ffmpeg vainfo.png" /></p>

<h3 id="3-在jellyfin中开启硬件加速转码选择qsv选项">3 在Jellyfin中开启硬件加速转码，选择QSV选项</h3>

<p><img src="/assets/images/2025-07-23 jellyfin transcodiing settings.png" alt="2025-07-23 jellyfin transcodiing settings.png" /></p>

<h3 id="4-验证jellyfin能成功通过qsv完成硬件加速转码">4 验证Jellyfin能成功通过QSV完成硬件加速转码</h3>

<h4 id="41-install-the-intel-gpu-tools-package-on-the-host-system">4.1 Install the intel-gpu-tools package on the host system</h4>

<p>On Debian &amp; Ubuntu:</p>

<p><code class="language-plaintext highlighter-rouge">sudo apt update &amp;&amp; sudo apt install -y intel-gpu-tools</code></p>

<h4 id="42-play-a-video-in-jellyfin-web-client-and-trigger-a-video-transcoding-by-setting-a-lower-resolution-or-bitrate">4.2 Play a video in Jellyfin web client and trigger a video transcoding by setting a lower resolution or bitrate.</h4>

<p><img src="/assets/images/2025-07-23 jellyfin transcoding info.png" alt="2025-07-23 jellyfin transcoding info.png" /></p>

<h4 id="43-use-intel_gpu_top-command-to-check-the-occupancy-of-the-engines-as-follows">4.3 Use <code class="language-plaintext highlighter-rouge">intel_gpu_top</code> command to check the occupancy of the engines as follows:</h4>

<p><img src="/assets/images/2025-07-23 verify GPU transcoding on linux.png" alt="2025-07-23 verify GPU transcoding on linux.png" /></p>

<p>本地系统配置好并验证Jellyfin能成功通过QSV完成硬件加速转码后，可以考虑进一步配置Docker版Jellyfin的硬件解码，以后可以考虑只通过Docker运行Jellfyin，方便管理。当然硬件转码最简单的方法还是直接本地运行Jellyfin，因为本地版本的设置步骤更加简单，调试也更加方便直接，可能出现的问题更少。</p>

<h2 id="在j4125小主机上通过docker运行jellyfin并实现硬件加速转码的步骤">在J4125小主机上通过Docker运行Jellyfin并实现硬件加速转码的步骤：</h2>

<h3 id="1-根据jellyfin官方文档在docker上安装jellyfin">1 根据<a href="https://jellyfin.org/docs/general/installation/container#using-docker-compose">Jellyfin官方文档</a>在Docker上安装Jellyfin</h3>

<h3 id="2-query-the-id-of-the-render-group-on-the-host-system">2 Query the id of the render group on the host system</h3>

<p><code class="language-plaintext highlighter-rouge">getent group render | cut -d: -f3</code></p>

<h3 id="3-use-render-group-in-the-docker-cli-or-docker-compose-file">3. Use render group in the Docker CLI or docker-compose file</h3>

<p>Example docker-compose configuration file written in YAML:</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">jellyfin</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">jellyfin/jellyfin</span>
    <span class="na">user</span><span class="pi">:</span> <span class="s">1000:1000</span>
    <span class="na">group_add</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">122'</span> <span class="c1"># Change this to match your "render" host group id and remove this comment</span>
    <span class="na">network_mode</span><span class="pi">:</span> <span class="s1">'</span><span class="s">host'</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/path/to/config:/config</span>
      <span class="pi">-</span> <span class="s">/path/to/cache:/cache</span>
      <span class="pi">-</span> <span class="s">/path/to/media:/media</span>
    <span class="na">devices</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/dev/dri/renderD128:/dev/dri/renderD128</span>
</code></pre></div></div>

<h3 id="4-check-the-qsv-and-va-api-codecs-in-container">4 Check the QSV and VA-API codecs in container</h3>

<p><code class="language-plaintext highlighter-rouge">docker exec -it jellyfin /usr/lib/jellyfin-ffmpeg/vainfo</code></p>

<h3 id="5-check-the-opencl-runtime-status-in-container">5 Check the OpenCL runtime status in container</h3>

<p><code class="language-plaintext highlighter-rouge">docker exec -it jellyfin /usr/lib/jellyfin-ffmpeg/ffmpeg -v verbose -init_hw_device vaapi=va -init_hw_device opencl@va</code></p>

<h3 id="6-enable-qsv-or-va-api-in-jellyfin">6 Enable QSV or VA-API in Jellyfin</h3>

<p>参考：<a href="https://jellyfin.org/docs/general/post-install/transcoding/hardware-acceleration/intel#configure-with-linux-virtualization">Jellyfin官方文档</a></p>

<p>注意：区分Linuxserver.io版本的Jellyfin Docker镜像与Jellyfin官方版本，两者的Jellyfin config和data文件的路径配置有所不同。</p>

<h2 id="在j4125小主机的ubuntu系统上运行ersatztv并实现硬件加速转码的步骤">在J4125小主机的Ubuntu系统上运行ErsatzTV并实现硬件加速转码的步骤：</h2>

<h3 id="1-按照ersatztv官方文档在ubuntu上安装ersatztv">1 按照<a href="https://ersatztv.org/docs/user-guide/install#linux">ErsatzTV官方文档</a>在Ubuntu上安装ErsatzTV</h3>

<h3 id="2-进入settings将ffpmeg和ffprobe路径改为jellyfin-ffmpeg7的安装路径">2 进入Settings，将ffpmeg和ffprobe路径改为jellyfin-ffmpeg7的安装路径</h3>

<ul>
  <li>ffmpeg path: <code class="language-plaintext highlighter-rouge">/usr/lib/jellyfin-ffmpeg/ffmpeg</code></li>
  <li>ffprobe path: <code class="language-plaintext highlighter-rouge">/usr/lib/jellyfin-ffmpeg/ffprobe</code></li>
</ul>

<h3 id="3-编辑ffmpeg-profile开启硬件加速转码选择qsv选项">3 编辑FFmpeg Profile，开启硬件加速转码，选择QSV选项</h3>

<p><img src="/assets/images/2025-07-23 ersatztv ffmpeg profile settings.png" alt="2025-07-23 ersatztv ffmpeg profile settings.png" /></p>

<h3 id="4-进入troubleshooting展开qsv-capabilities检查输出结果">4 进入Troubleshooting，展开QSV Capabilities，检查输出结果</h3>

<p>检查输出中jellyfin-ffmpeg7是否被正确使用以及结果中是否存在任何报错（比如, “Error creating a MFX session: -9”, “No VA display found for device /dev/dri/renderD128”等）。如果Exit Code不为0或者输出最后出现“Conversion Failed”字样，即表示硬件转码不成功；反之，如果输出中Exit Code为0并且输出最后没有出现“Conversion Failed”字样，即表示硬件转码成功。</p>

<p>ErsatzTV - Troubleshooting - QSV Capabilities 硬件转码成功的输出样例：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Checking device /dev/dri/renderD128
Exit Code: 0

ffmpeg version 7.1.1-Jellyfin Copyright (c) 2000-2025 the FFmpeg developers
  built with gcc 11 (Ubuntu 11.4.0-1ubuntu1~22.04)
  configuration: --prefix=/usr/lib/jellyfin-ffmpeg --target-os=linux --extra-version=Jellyfin --disable-doc --disable-ffplay --disable-static --disable-libxcb --disable-sdl2 --disable-xlib --enable-lto=auto --enable-gpl --enable-version3 --enable-shared --enable-gmp --enable-gnutls --enable-chromaprint --enable-opencl --enable-libdrm --enable-libxml2 --enable-libass --enable-libfreetype --enable-libfribidi --enable-libfontconfig --enable-libharfbuzz --enable-libbluray --enable-libmp3lame --enable-libopus --enable-libtheora --enable-libvorbis --enable-libopenmpt --enable-libdav1d --enable-libsvtav1 --enable-libwebp --enable-libvpx --enable-libx264 --enable-libx265 --enable-libzvbi --enable-libzimg --enable-libfdk-aac --arch=amd64 --enable-libshaderc --enable-libplacebo --enable-vulkan --enable-vaapi --enable-amf --enable-libvpl --enable-ffnvcodec --enable-cuda --enable-cuda-llvm --enable-cuvid --enable-nvdec --enable-nvenc
  libavutil      59. 39.100 / 59. 39.100
  libavcodec     61. 19.101 / 61. 19.101
  libavformat    61.  7.100 / 61.  7.100
  libavdevice    61.  3.100 / 61.  3.100
  libavfilter    10.  4.100 / 10.  4.100
  libswscale      8.  3.100 /  8.  3.100
  libswresample   5.  3.100 /  5.  3.100
  libpostproc    58.  3.100 / 58.  3.100
libva info: VA-API version 1.22.0
libva info: Trying to open /usr/lib/jellyfin-ffmpeg/lib/dri/iHD_drv_video.so
libva info: Found init function __vaDriverInit_1_22
libva info: va_openDriver() returns 0
libva info: VA-API version 1.22.0
libva info: Trying to open /usr/lib/jellyfin-ffmpeg/lib/dri/iHD_drv_video.so
libva info: Found init function __vaDriverInit_1_22
libva info: va_openDriver() returns 0
Input #0, lavfi, from 'nullsrc':
  Duration: N/A, start: 0.000000, bitrate: N/A
  Stream #0:0: Video: wrapped_avframe, yuv420p, 320x240 [SAR 1:1 DAR 4:3], 25 fps, 25 tbr, 25 tbn
Stream mapping:
  Stream #0:0 -&gt; #0:0 (wrapped_avframe (native) -&gt; h264 (h264_qsv))
Press [q] to stop, [?] for help
libva info: VA-API version 1.22.0
libva info: Trying to open /usr/lib/jellyfin-ffmpeg/lib/dri/iHD_drv_video.so
libva info: Found init function __vaDriverInit_1_22
libva info: va_openDriver() returns 0
[h264_qsv @ 0x5863317fbfc0] Using the constant quantization parameter (CQP) by default. Please use the global_quality option and other options for a quality-based mode or the b option and other options for a bitrate-based mode if the default is not the desired choice.
Output #0, null, to 'pipe:':
  Metadata:
    encoder         : Lavf61.7.100
  Stream #0:0: Video: h264, nv12(tv, progressive), 320x240 [SAR 1:1 DAR 4:3], q=2-31, 25 fps, 25 tbn
      Metadata:
        encoder         : Lavc61.19.101 h264_qsv
      Side data:
        cpb: bitrate max/min/avg: 0/0/0 buffer size: 0 vbv_delay: N/A
[out#0/null @ 0x5863311d9600] video:1KiB audio:0KiB subtitle:0KiB other streams:0KiB global headers:0KiB muxing overhead: unknown
frame=   25 fps=0.0 q=35.0 Lsize=N/A time=00:00:00.88 bitrate=N/A speed=9.19x    


Checking device /dev/dri/card0
Exit Code: 0

ffmpeg version 7.1.1-Jellyfin Copyright (c) 2000-2025 the FFmpeg developers
  built with gcc 11 (Ubuntu 11.4.0-1ubuntu1~22.04)
  configuration: --prefix=/usr/lib/jellyfin-ffmpeg --target-os=linux --extra-version=Jellyfin --disable-doc --disable-ffplay --disable-static --disable-libxcb --disable-sdl2 --disable-xlib --enable-lto=auto --enable-gpl --enable-version3 --enable-shared --enable-gmp --enable-gnutls --enable-chromaprint --enable-opencl --enable-libdrm --enable-libxml2 --enable-libass --enable-libfreetype --enable-libfribidi --enable-libfontconfig --enable-libharfbuzz --enable-libbluray --enable-libmp3lame --enable-libopus --enable-libtheora --enable-libvorbis --enable-libopenmpt --enable-libdav1d --enable-libsvtav1 --enable-libwebp --enable-libvpx --enable-libx264 --enable-libx265 --enable-libzvbi --enable-libzimg --enable-libfdk-aac --arch=amd64 --enable-libshaderc --enable-libplacebo --enable-vulkan --enable-vaapi --enable-amf --enable-libvpl --enable-ffnvcodec --enable-cuda --enable-cuda-llvm --enable-cuvid --enable-nvdec --enable-nvenc
  libavutil      59. 39.100 / 59. 39.100
  libavcodec     61. 19.101 / 61. 19.101
  libavformat    61.  7.100 / 61.  7.100
  libavdevice    61.  3.100 / 61.  3.100
  libavfilter    10.  4.100 / 10.  4.100
  libswscale      8.  3.100 /  8.  3.100
  libswresample   5.  3.100 /  5.  3.100
  libpostproc    58.  3.100 / 58.  3.100
[AVHWDeviceContext @ 0x64e36a2e9600] libva: vaGetDriverNames() failed with operation failed
libva info: VA-API version 1.22.0
libva info: Trying to open /usr/lib/jellyfin-ffmpeg/lib/dri/iHD_drv_video.so
libva info: Found init function __vaDriverInit_1_22
libva info: va_openDriver() returns 0
libva info: VA-API version 1.22.0
libva info: Trying to open /usr/lib/jellyfin-ffmpeg/lib/dri/iHD_drv_video.so
libva info: Found init function __vaDriverInit_1_22
libva info: va_openDriver() returns 0
Input #0, lavfi, from 'nullsrc':
  Duration: N/A, start: 0.000000, bitrate: N/A
  Stream #0:0: Video: wrapped_avframe, yuv420p, 320x240 [SAR 1:1 DAR 4:3], 25 fps, 25 tbr, 25 tbn
Stream mapping:
  Stream #0:0 -&gt; #0:0 (wrapped_avframe (native) -&gt; h264 (h264_qsv))
Press [q] to stop, [?] for help
libva info: VA-API version 1.22.0
libva info: Trying to open /usr/lib/jellyfin-ffmpeg/lib/dri/iHD_drv_video.so
libva info: Found init function __vaDriverInit_1_22
libva info: va_openDriver() returns 0
[h264_qsv @ 0x64e36a442a40] Using the constant quantization parameter (CQP) by default. Please use the global_quality option and other options for a quality-based mode or the b option and other options for a bitrate-based mode if the default is not the desired choice.
Output #0, null, to 'pipe:':
  Metadata:
    encoder         : Lavf61.7.100
  Stream #0:0: Video: h264, nv12(tv, progressive), 320x240 [SAR 1:1 DAR 4:3], q=2-31, 25 fps, 25 tbn
      Metadata:
        encoder         : Lavc61.19.101 h264_qsv
      Side data:
        cpb: bitrate max/min/avg: 0/0/0 buffer size: 0 vbv_delay: N/A
[out#0/null @ 0x64e36a378740] video:1KiB audio:0KiB subtitle:0KiB other streams:0KiB global headers:0KiB muxing overhead: unknown
frame=   25 fps=0.0 q=35.0 Lsize=N/A time=00:00:00.88 bitrate=N/A speed=6.12x    
</code></pre></div></div>

<p>ErsatzTV - Troubleshooting - QSV Capabilities 硬件转码失败的输出样例：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Checking device /dev/dri/renderD128
Exit Code: 171

ffmpeg version n7.1.1-56-gc2184b65d2-20250716 Copyright (c) 2000-2025 the FFmpeg developers
  built with gcc 15.1.0 (crosstool-NG 1.27.0.42_35c1e72)
  configuration: --prefix=/ffbuild/prefix --pkg-config-flags=--static --pkg-config=pkg-config --cross-prefix=x86_64-ffbuild-linux-gnu- --arch=x86_64 --target-os=linux --enable-gpl --enable-version3 --disable-debug --enable-iconv --enable-zlib --enable-libfribidi --enable-gmp --enable-libxml2 --enable-openssl --enable-lzma --enable-fontconfig --enable-libharfbuzz --enable-libfreetype --enable-libvorbis --enable-opencl --enable-libpulse --enable-libvmaf --enable-libxcb --enable-xlib --enable-amf --enable-libaom --enable-libaribb24 --enable-avisynth --enable-chromaprint --enable-libdav1d --enable-libdavs2 --enable-libdvdread --enable-libdvdnav --disable-libfdk-aac --enable-ffnvcodec --enable-cuda-llvm --enable-frei0r --enable-libgme --enable-libkvazaar --enable-libaribcaption --enable-libass --enable-libbluray --enable-libjxl --enable-libmp3lame --enable-libopus --enable-librist --enable-libssh --enable-libtheora --enable-libvpx --enable-libwebp --enable-libzmq --enable-lv2 --enable-libvpl --enable-openal --enable-libopencore-amrnb --enable-libopencore-amrwb --enable-libopenh264 --enable-libopenjpeg --enable-libopenmpt --enable-librav1e --enable-librubberband --disable-schannel --enable-sdl2 --enable-libsnappy --enable-libsoxr --enable-libsrt --enable-libsvtav1 --enable-libtwolame --enable-libuavs3d --enable-libdrm --enable-vaapi --enable-libvidstab --enable-vulkan --enable-libshaderc --enable-libplacebo --enable-libvvenc --enable-libx264 --enable-libx265 --enable-libxavs2 --enable-libxvid --enable-libzimg --enable-libzvbi --extra-cflags=-DLIBTWOLAME_STATIC --extra-cxxflags= --extra-libs='-ldl -lgomp' --extra-ldflags=-pthread --extra-ldexeflags=-pie --cc=x86_64-ffbuild-linux-gnu-gcc --cxx=x86_64-ffbuild-linux-gnu-g++ --ar=x86_64-ffbuild-linux-gnu-gcc-ar --ranlib=x86_64-ffbuild-linux-gnu-gcc-ranlib --nm=x86_64-ffbuild-linux-gnu-gcc-nm --extra-version=20250716
  libavutil      59. 39.100 / 59. 39.100
  libavcodec     61. 19.101 / 61. 19.101
  libavformat    61.  7.100 / 61.  7.100
  libavdevice    61.  3.100 / 61.  3.100
  libavfilter    10.  4.100 / 10.  4.100
  libswscale      8.  3.100 /  8.  3.100
  libswresample   5.  3.100 /  5.  3.100
  libpostproc    58.  3.100 / 58.  3.100
[AVHWDeviceContext @ 0x57ee44e15780] libva: Failed to get device id from the driver. Please consider to upgrade the driver to support VA-API 1.15.0
Device creation failed: -1313558101.
Failed to set value '/dev/dri/renderD128' for option 'qsv_device': Unknown error occurred
Error parsing global options: Unknown error occurred


Checking device /dev/dri/card0
Exit Code: 171

ffmpeg version n7.1.1-56-gc2184b65d2-20250716 Copyright (c) 2000-2025 the FFmpeg developers
  built with gcc 15.1.0 (crosstool-NG 1.27.0.42_35c1e72)
  configuration: --prefix=/ffbuild/prefix --pkg-config-flags=--static --pkg-config=pkg-config --cross-prefix=x86_64-ffbuild-linux-gnu- --arch=x86_64 --target-os=linux --enable-gpl --enable-version3 --disable-debug --enable-iconv --enable-zlib --enable-libfribidi --enable-gmp --enable-libxml2 --enable-openssl --enable-lzma --enable-fontconfig --enable-libharfbuzz --enable-libfreetype --enable-libvorbis --enable-opencl --enable-libpulse --enable-libvmaf --enable-libxcb --enable-xlib --enable-amf --enable-libaom --enable-libaribb24 --enable-avisynth --enable-chromaprint --enable-libdav1d --enable-libdavs2 --enable-libdvdread --enable-libdvdnav --disable-libfdk-aac --enable-ffnvcodec --enable-cuda-llvm --enable-frei0r --enable-libgme --enable-libkvazaar --enable-libaribcaption --enable-libass --enable-libbluray --enable-libjxl --enable-libmp3lame --enable-libopus --enable-librist --enable-libssh --enable-libtheora --enable-libvpx --enable-libwebp --enable-libzmq --enable-lv2 --enable-libvpl --enable-openal --enable-libopencore-amrnb --enable-libopencore-amrwb --enable-libopenh264 --enable-libopenjpeg --enable-libopenmpt --enable-librav1e --enable-librubberband --disable-schannel --enable-sdl2 --enable-libsnappy --enable-libsoxr --enable-libsrt --enable-libsvtav1 --enable-libtwolame --enable-libuavs3d --enable-libdrm --enable-vaapi --enable-libvidstab --enable-vulkan --enable-libshaderc --enable-libplacebo --enable-libvvenc --enable-libx264 --enable-libx265 --enable-libxavs2 --enable-libxvid --enable-libzimg --enable-libzvbi --extra-cflags=-DLIBTWOLAME_STATIC --extra-cxxflags= --extra-libs='-ldl -lgomp' --extra-ldflags=-pthread --extra-ldexeflags=-pie --cc=x86_64-ffbuild-linux-gnu-gcc --cxx=x86_64-ffbuild-linux-gnu-g++ --ar=x86_64-ffbuild-linux-gnu-gcc-ar --ranlib=x86_64-ffbuild-linux-gnu-gcc-ranlib --nm=x86_64-ffbuild-linux-gnu-gcc-nm --extra-version=20250716
  libavutil      59. 39.100 / 59. 39.100
  libavcodec     61. 19.101 / 61. 19.101
  libavformat    61.  7.100 / 61.  7.100
  libavdevice    61.  3.100 / 61.  3.100
  libavfilter    10.  4.100 / 10.  4.100
  libswscale      8.  3.100 /  8.  3.100
  libswresample   5.  3.100 /  5.  3.100
  libpostproc    58.  3.100 / 58.  3.100
[AVHWDeviceContext @ 0x56747aacf7c0] libva: Failed to get device id from the driver. Please consider to upgrade the driver to support VA-API 1.15.0
Device creation failed: -1313558101.
Failed to set value '/dev/dri/card0' for option 'qsv_device': Unknown error occurred
Error parsing global options: Unknown error occurred
</code></pre></div></div>

<h3 id="5-auto-start-ersatztv-as-a-systemd-service">5 Auto start ersatztv as a systemd service</h3>

<p>创建一个如下的<code class="language-plaintext highlighter-rouge">ersatztv.service</code>文件：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># /etc/systemd/system/ersatztv.service

[Unit]
Description=ErsatzTV Service

[Service]
ExecStart=/home/greg/Applications/ersatztv/ErsatzTV-v25.2.0-linux-x64/ErsatzTV
Restart=on-abort
User=root
WorkingDirectory=/home/greg/Applications/ersatztv/ErsatzTV-v25.2.0-linux-x64

[Install]
WantedBy=multi-user.target
</code></pre></div></div>

<p>Enable the service to start on boot:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl daemon-reload
<span class="nb">sudo </span>systemctl <span class="nb">enable </span>ersatztv.service
</code></pre></div></div>

  </div>

  <!-- <div class="reward">
    <p>觉得文章对你有帮助？打赏以支持作者持续创作：</p>
    <div class="reward-button">
      <span class="alipay-code"><img class="alipay-img wdp-appear" alt="支付宝打赏" src="https://goooooouwa.eu.org:8143/static/images/alipay_paycode.jpg"></span>
    </div>
  </div> --><script src="https://utteranc.es/client.js" repo="goooooouwa/goooooouwa.github.io" issue-term="pathname"
    theme="github-light" crossorigin="anonymous" async>
    </script>

  <a class="u-url" href="/computer/2025/07/23/jellyfin-ersatztv-hardware-accelerated-transcoding-in-ubuntu.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>订阅</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">徐顺发</li>
          <li><a class="u-email" href="mailto:gouwa5700 (at) gmail (dot) com">gouwa5700 (at) gmail (dot) com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>记录生活、学习和思考
</p>
        <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br />本网站采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可。
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li>
  <a rel="me" href="https://github.com/goooooouwa" target="_blank" title="github">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#github"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://twitter.com/Goooooouwa" target="_blank" title="twitter">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#twitter"></use>
    </svg>
  </a>
</li>
</ul>
</div>

  </div>

</footer>
</body>

</html>